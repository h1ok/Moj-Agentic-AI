# ุฏููู ูุธุงู ุงูุฅุฏุงุฑุฉ - Admin System Guide

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ูุธุงู ุฅุฏุงุฑุฉ ูุงูู ูุณูุญ ูููุณุคูููู ุจุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูููุงุนุฏ ุงูุจูุงูุงุช.

## ุงููููุฒุงุช

### 1. ููุญุฉ ุงูุชุญูู ุงูุฅุฏุงุฑูุฉ
- ๐ ุฅุญุตุงุฆูุงุช ุดุงููุฉ (ุฅุฌูุงูู ุงููุณุชุฎุฏูููุ ุงููุดุทููุ ุงููุณุคูููู)
- ๐ฅ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู (ุนุฑุถุ ุชุนุฏููุ ุญุฐู)
- ๐ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช (ุชูุนูู/ุชุนุทููุ ููุญ/ุฅุฒุงูุฉ ุตูุงุญูุงุช ุงููุณุคูู)
- ๐๏ธ ุญุฐู ุงููุณุชุฎุฏููู

### 2. ูุธุงู ุงูุตูุงุญูุงุช
- **is_admin**: ุตูุงุญูุงุช ุงููุณุคูู
- **is_active**: ุญุงูุฉ ุงููุณุชุฎุฏู (ูุดุท/ูุนุทู)

## ุงูุจููุฉ ุงูุชูููุฉ

### Backend

#### 1. ุชุญุฏูุซ User Model
**ุงูููู:** `app/db/models.py`

```python
class User(Base):
    # ... ุงูุญููู ุงูููุฌูุฏุฉ
    is_admin = Column(Boolean, default=False, nullable=False)
    is_active = Column(Boolean, default=True, nullable=False)
```

#### 2. Admin Middleware
**ุงูููู:** `app/auth/admin_dependencies.py`

```python
async def require_admin(current_user: User = Depends(require_current_user)):
    """ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุณุคูู"""
    if not current_user.is_admin:
        raise HTTPException(status_code=403, detail="Admin privileges required")
    return current_user
```

#### 3. Admin API Endpoints
**ุงูููู:** `app/api/admin_routes.py`

**ุงูุฅุญุตุงุฆูุงุช:**
```
GET /api/admin/stats
Authorization: Bearer {token}
```

**ูุงุฆูุฉ ุงููุณุชุฎุฏููู:**
```
GET /api/admin/users
Authorization: Bearer {token}
```

**ุชุญุฏูุซ ูุณุชุฎุฏู:**
```
PUT /api/admin/users/{user_id}
Authorization: Bearer {token}
Content-Type: application/json

{
  "is_admin": true,
  "is_active": true,
  "name": "ุงุณู ุฌุฏูุฏ"
}
```

**ุญุฐู ูุณุชุฎุฏู:**
```
DELETE /api/admin/users/{user_id}
Authorization: Bearer {token}
```

### Frontend

#### 1. ุตูุญุฉ ููุญุฉ ุงูุชุญูู
**ุงูููู:** `frontend/src/pages/AdminDashboard.jsx`

**ุงููููุฒุงุช:**
- ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ูู ุจุทุงูุงุช
- ุฌุฏูู ุงููุณุชุฎุฏููู ูุน ุฅููุงููุฉ ุงูุชุนุฏูู
- ุชุจุฏูู ุงูุญุงูุฉ (ูุดุท/ูุนุทู) ุจููุฑุฉ ูุงุญุฏุฉ
- ุชุจุฏูู ุงูุตูุงุญูุงุช (ูุณุคูู/ูุณุชุฎุฏู) ุจููุฑุฉ ูุงุญุฏุฉ
- ุญุฐู ุงููุณุชุฎุฏููู ูุน ุชุฃููุฏ

#### 2. ุงููุตูู ูููุญุฉ ุงูุชุญูู
**Route:** `/admin`

**ุงูุญูุงูุฉ:**
- ูุชุทูุจ ุชุณุฌูู ุฏุฎูู
- ูุชุทูุจ ุตูุงุญูุงุช ูุณุคูู (`is_admin = true`)
- ุฅุนุงุฏุฉ ุชูุฌูู ุชููุงุฆูุฉ ูููุณุชุฎุฏููู ุงูุนุงุฏููู

#### 3. ุฑุงุจุท ูู ูุงุฆูุฉ ุงููุณุชุฎุฏู
**ุงูููู:** `frontend/src/components/Sidebar.jsx`

- ูุธูุฑ ุฑุงุจุท "ููุญุฉ ุงูุชุญูู ุงูุฅุฏุงุฑูุฉ" ููุท ูููุณุคูููู
- ููู ูููุฒ (ุจููุณุฌู) ููุชูููุฒ

## ุงูุชุซุจูุช ูุงูุฅุนุฏุงุฏ

### 1. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช

```bash
# ูู ูุฌูุฏ ุงููุดุฑูุน
python update_admin_fields.py
```

ูุฐุง ุงูุณูุฑูุจุช ุณูููู ุจู:
- โ ุฅุถุงูุฉ ุนููุฏ `is_admin`
- โ ุฅุถุงูุฉ ุนููุฏ `is_active`
- โ ุฌุนู ุฃูู ูุณุชุฎุฏู ูุณุคููุงู ุชููุงุฆูุงู

### 2. ุฅุนุงุฏุฉ ุชุดุบูู Backend

```bash
python run.py
```

### 3. ุชุดุบูู Frontend

```bash
cd frontend
npm run dev
```

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูููุณุคูู:

1. **ุงููุตูู ูููุญุฉ ุงูุชุญูู:**
   - ุณุฌู ุงูุฏุฎูู
   - ุงุถุบุท ุนูู ุงุณูู ูู Sidebar
   - ุงุฎุชุฑ "ููุญุฉ ุงูุชุญูู ุงูุฅุฏุงุฑูุฉ"

2. **ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช:**
   - ูู ุฃุนูู ุงูุตูุญุฉ ุณุชุฌุฏ ุจุทุงูุงุช ุงูุฅุญุตุงุฆูุงุช:
     - ุฅุฌูุงูู ุงููุณุชุฎุฏููู
     - ุงููุณุชุฎุฏููู ุงููุดุทูู
     - ุนุฏุฏ ุงููุณุคูููู

3. **ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู:**
   - **ุชูุนูู/ุชุนุทูู:** ุงุถุบุท ุนูู ุฒุฑ ุงูุญุงูุฉ (ูุดุท/ูุนุทู)
   - **ููุญ ุตูุงุญูุงุช ูุณุคูู:** ุงุถุบุท ุนูู ุฒุฑ ุงูุตูุงุญูุงุช (ูุณุคูู/ูุณุชุฎุฏู)
   - **ุญุฐู ูุณุชุฎุฏู:** ุงุถุบุท ุนูู ุฃููููุฉ ุณูุฉ ุงูููููุงุช

4. **ุงููููุฏ ุงูุฃูููุฉ:**
   - โ ูุง ููููู ุชุนุทูู ุญุณุงุจู ุงูุฎุงุต
   - โ ูุง ููููู ุญุฐู ุญุณุงุจู ุงูุฎุงุต
   - โ ููููู ุฅุฏุงุฑุฉ ุฌููุน ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู

### ูููุณุชุฎุฏู ุงูุนุงุฏู:

- ูู ูุฑู ุฑุงุจุท "ููุญุฉ ุงูุชุญูู ุงูุฅุฏุงุฑูุฉ"
- ุฅุฐุง ุญุงูู ุงููุตูู ูู `/admin` ุณูุชู ุฅุนุงุฏุฉ ุชูุฌููู ูู `/chat`
- ุฅุฐุง ุญุงูู ุงุณุชุฎุฏุงู Admin API ุณูุญุตู ุนูู ุฎุทุฃ 403

## API Endpoints ุงููุงููุฉ

### 1. ุงูุฅุญุตุงุฆูุงุช
```http
GET /api/admin/stats
Authorization: Bearer {admin_token}

Response:
{
  "total_users": 10,
  "active_users": 8,
  "inactive_users": 2,
  "admin_users": 2,
  "total_x_accounts": 5,
  "users_created_today": 1
}
```

### 2. ูุงุฆูุฉ ุงููุณุชุฎุฏููู
```http
GET /api/admin/users?skip=0&limit=100
Authorization: Bearer {admin_token}

Response:
[
  {
    "id": 1,
    "email": "admin@example.com",
    "name": "ุงููุณุคูู",
    "profile_picture": "base64...",
    "is_admin": true,
    "is_active": true,
    "created_at": "2026-01-20T12:00:00",
    "x_accounts_count": 2
  }
]
```

### 3. ูุนูููุงุช ูุณุชุฎุฏู ูุญุฏุฏ
```http
GET /api/admin/users/{user_id}
Authorization: Bearer {admin_token}
```

### 4. ุชุญุฏูุซ ูุณุชุฎุฏู
```http
PUT /api/admin/users/{user_id}
Authorization: Bearer {admin_token}
Content-Type: application/json

{
  "is_admin": true,
  "is_active": false,
  "name": "ุงุณู ูุญุฏุซ"
}
```

### 5. ุญุฐู ูุณุชุฎุฏู
```http
DELETE /api/admin/users/{user_id}
Authorization: Bearer {admin_token}

Response:
{
  "message": "User user@example.com deleted successfully",
  "success": true
}
```

### 6. ุญุณุงุจุงุช X
```http
GET /api/admin/x-accounts?skip=0&limit=100
Authorization: Bearer {admin_token}
```

## ุงูุฃูุงู

### 1. ุงููุตุงุฏูุฉ
- ุฌููุน endpoints ูุญููุฉ ุจู JWT authentication
- ูุชุทูุจ `require_admin` dependency

### 2. ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
```python
if not current_user.is_admin:
    raise HTTPException(status_code=403, detail="Admin privileges required")
```

### 3. ุงูุญูุงูุฉ ูู ุงูุฃุฎุทุงุก
- ูุง ูููู ูููุณุคูู ุชุนุทูู ููุณู
- ูุง ูููู ูููุณุคูู ุญุฐู ููุณู
- ุงูุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู ูุจู ุงูุชุนุฏูู/ุงูุญุฐู

## ุงููููุงุช ุงููุถุงูุฉ/ุงููุนุฏูุฉ

### Backend:
1. โ `app/db/models.py` - ุฅุถุงูุฉ is_admin ู is_active
2. โ `app/auth/admin_dependencies.py` - middleware ุงููุณุคูู (ุฌุฏูุฏ)
3. โ `app/api/admin_routes.py` - Admin API endpoints (ุฌุฏูุฏ)
4. โ `app/main.py` - ุชุถููู admin routes
5. โ `app/auth/routes.py` - ุชุญุฏูุซ UserResponse
6. โ `update_admin_fields.py` - ุณูุฑูุจุช ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุฌุฏูุฏ)

### Frontend:
1. โ `frontend/src/pages/AdminDashboard.jsx` - ุตูุญุฉ ููุญุฉ ุงูุชุญูู (ุฌุฏูุฏ)
2. โ `frontend/src/App.jsx` - ุฅุถุงูุฉ admin route
3. โ `frontend/src/components/Sidebar.jsx` - ุฑุงุจุท ููุญุฉ ุงูุชุญูู

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: "Admin privileges required"
**ุงูุณุจุจ:** ุงููุณุชุฎุฏู ููุณ ูุณุคููุงู
**ุงูุญู:** 
```sql
UPDATE users SET is_admin = 1 WHERE email = 'your@email.com';
```

### ุงููุดููุฉ: ูุง ูุธูุฑ ุฑุงุจุท ููุญุฉ ุงูุชุญูู
**ุงูุณุจุจ:** `user.is_admin` ุบูุฑ ูุญุฏุซ ูู Frontend
**ุงูุญู:**
1. ุณุฌู ุฎุฑูุฌ
2. ุณุฌู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู
3. ุชุญูู ูู localStorage:
```javascript
console.log(JSON.parse(localStorage.getItem('user')))
```

### ุงููุดููุฉ: 403 ุนูุฏ ุงููุตูู ูู Admin API
**ุงูุณุจุจ:** Token ุบูุฑ ุตุงูุญ ุฃู ุงููุณุชุฎุฏู ููุณ ูุณุคููุงู
**ุงูุญู:**
1. ุชุญูู ูู Token ูู localStorage
2. ุชุญูู ูู is_admin ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุณุฌู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู

## ููุงุญุธุงุช ูููุฉ

1. **ุงููุณุชุฎุฏู ุงูุฃูู** ูุตุจุญ ูุณุคููุงู ุชููุงุฆูุงู ุจุนุฏ ุชุดุบูู `update_admin_fields.py`
2. **ุงูุญุฐู ูุชุชุงูู** - ุญุฐู ูุณุชุฎุฏู ูุญุฐู ุฌููุน ุญุณุงุจุงุช X ุงููุฑุชุจุทุฉ ุจู
3. **ุงูุชุญุฏูุซ ุงูููุฑู** - ุงูุชุบููุฑุงุช ุชุธูุฑ ูุจุงุดุฑุฉ ุจุฏูู ุฅุนุงุฏุฉ ุชุญููู
4. **ุงูุญูุงูุฉ ุงููุงููุฉ** - ุฌููุน endpoints ูุญููุฉ ููุตุงุฏู ุนูููุง

## ุงูุฎูุงุตุฉ

ูุธุงู ุฅุฏุงุฑุฉ ูุงูู ููุชูุงูู:
- โ ููุญุฉ ุชุญูู ุดุงููุฉ
- โ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
- โ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
- โ ุฅุญุตุงุฆูุงุช ููุตูุฉ
- โ ุญูุงูุฉ ูุงููุฉ
- โ ูุงุฌูุฉ ุณููุฉ ุงูุงุณุชุฎุฏุงู
